Refactor to allow event signing to depend on room version
